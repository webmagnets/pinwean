<!DOCTYPE html>
<!--[if lte IE 6]><html class="preIE7 preIE8 preIE9"><![endif]-->
<!--[if IE 7]><html class="preIE8 preIE9"><![endif]-->
<!--[if IE 8]><html class="preIE9"><![endif]-->
<!--[if gte IE 9]><!-->
<html>
<!--<![endif]-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Words you are learning</title>
    <style type="text/css">

    </style>
</head>

<body>
    <h1>Words you are learning:</h1>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        function markAsKnown() {
            console.log('this',this)
            let word = this.dataset.word
            jQuery.post("https://us-central1-slowmersion.cloudfunctions.net/markAsKnown?username=" + smusername + "&password=" + smuserId + "&word=" + word, function (data, status) {
				 console.log(status, data)
			});
		console.log('hiding',$(this).parents('p')
		jQuery(this).parents('p').hide()
        }
        function autorun() {
            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            };

            smusername = getUrlParameter('username'); // "1234"
            smuserId = getUrlParameter('userId'); // "edit"
            console.log(smusername, smuserId)
            jQuery.get('https://us-central1-slowmersion.cloudfunctions.net/words?username=' + smusername + '&userId=' +
                smuserId,
                function (data, status) {
                    if (status) {
                        console.log('status', status)
                    }
                    if (data) {
                        console.log('data', data)
                        data.forEach(word => {
                            console.log('word.def', word.def)
                            if (word && word.def) {
                                let definitions = JSON.parse(word.def)
                                JSON.parse(word.def).forEach(word => {
                                    console.log('word', word)
                                    $('body').append('<p>' + word.simplified + ' ' + word.pinyin +
                                        ' | ' + word.definition + ' <button onClick="markAsKnown.call(this)" data-word=' + word.simplified + ' data-pinyin=' + word.pinyin + ' class="markAsKnown">mark as known</button></p>')
                                });
                            } else {
                                $('body').append('<p>' + word.word + ' ' + word.pinyin + '</p>')
                            }

                        });
                    }
                })
        }
        if (document.addEventListener) document.addEventListener("DOMContentLoaded", autorun, false);
        else if (document.attachEvent) document.attachEvent("onreadystatechange", autorun);
        else window.onload = autorun;
    </script>
</body>

</html>
